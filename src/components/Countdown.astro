---
const { id, time } = Astro.props;

const attributes = time !== null ? { "data-time": time } : {};
---

<p>
  æ½œæ°´è‰¦{id}
  <span id={`timer${id}`} data-id={id} {...attributes}
    >ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</span
  >
</p>

<script>
  function updateCountdown() {
    console.log("ğŸ” updateCountdown() ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸ");

    document.querySelectorAll("[data-id]").forEach((timerElement) => {
      const id = timerElement.getAttribute("data-id");
      const timeAttr = timerElement.getAttribute("data-time");

      console.log(`ğŸ“Œ æ½œæ°´è‰¦ ${id} ã® data-time:`, timeAttr);

      if (
        !timeAttr ||
        Number.isNaN(Number(timeAttr)) ||
        timeAttr.trim() === ""
      ) {
        console.log(`âš ï¸ æ½œæ°´è‰¦ ${id}: ç„¡åŠ¹ãªã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ (${timeAttr})`);
        (timerElement as HTMLElement).innerText = "ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
        return;
      }

      const time = parseInt(timeAttr, 10);
      let timeLeft = time - Date.now();
      console.log(`â³ æ½œæ°´è‰¦ ${id} ã®æ®‹ã‚Šæ™‚é–“: ${timeLeft} ãƒŸãƒªç§’`);

      if (timeLeft > 0) {
        const days = Math.floor(timeLeft / 86400000);
        const hours = Math.floor((timeLeft % 86400000) / 3600000);
        const minutes = Math.floor((timeLeft % 3600000) / 60000);
        const seconds = Math.floor((timeLeft % 60000) / 1000);
        (timerElement as HTMLElement).innerText =
          `æ®‹ã‚Šæ™‚é–“: ${days}æ—¥ ${hours}æ™‚é–“ ${minutes}åˆ† ${seconds}ç§’`;
      } else {
        console.log(`ğŸš¢ æ½œæ°´è‰¦ ${id} åˆ°ç€ï¼`);
        (timerElement as HTMLElement).innerText = "åˆ°ç€ï¼ï¼ˆå®Œäº†ï¼‰";
      }
    });
  }

  document.addEventListener("DOMContentLoaded", updateCountdown);
  setInterval(updateCountdown, 1000);
</script>
